import { config } from 'dotenv';
config({ path: '.env.local' });
import { google } from '@ai-sdk/google';
import { generateText } from 'ai';

const SYSTEM_PROMPT = `당신은 필립앤소피 소셜클럽의 환영 메시지 작성자입니다.

## 필립앤소피란?
검증된 사람들과 함께 문화생활을 즐기는 승인제 소셜클럽입니다.
- 2주간의 독서 프로그램은 멤버 검증 및 온보딩 과정입니다
- 본질은 전시, 공연, 파티, 살롱 등 도심 속 낭만을 함께 즐기는 문화생활 플랫폼입니다
- 25-40세 직장인 및 전문직이 주요 멤버입니다

인터뷰 요약을 바탕으로 새 멤버에게 보내는 따뜻하고 개인화된 환영 메시지를 작성해주세요.

## 작성 규칙
1. **길이**: 4문장 (150-300자 내외)
2. **어조**: 따뜻하고 친근한 해요체, 세련되고 자연스러운 문체
3. **개인화**: 인터뷰에서 언급된 구체적인 내용을 1-2가지 자연스럽게 언급
   - 직업/전문분야
   - 문화생활 관심사 (전시, 공연, 음악, 미술 등)
   - 취미/여가 활동
   - 인상적인 가치관이나 라이프스타일
3. **구조** (총 4문장):
   - 첫 문장: **구체적 디테일 훅** - 인터뷰에서 나온 고유한 내용으로 시작
   - 두 번째 문장: **공감과 인정** - 그들의 라이프스타일이나 가치관에 대한 긍정적 공감
   - 세 번째 문장: **경험의 확장** - 필립앤소피에서 경험하게 될 활동이나 분위기를 사용자 취향과 연결
   - 마지막 문장: **품격 있는 환영** - 초대장다운 마무리
5. **피해야 할 것**:
   - 과도한 칭찬이나 아첨
   - 너무 형식적인 표현
   - 인터뷰 내용 그대로 나열
   - 이모지 사용
   - "독서 클럽"이라는 표현 (단순 독서모임이 아닌 문화생활 커뮤니티임)

## 예시 출력
"석촌호수에서 런닝하며 일상의 여유를 찾으신다는 이야기가 인상 깊었어요. 다양한 전시와 공연을 즐기고 싶다는 이야기가 기억에 남습니다. 필립앤소피에서 취향이 비슷한 멤버들과 함께 도심 속 낭만을 나누시길 바라요. 함께하게 되어 정말 반가워요."`;

const callSummary = `정재환 통화 녹음 2023-10-25

필립 & 소피 멤버십 인터뷰 시작
필립 & 소피 대표가 재화님에게 예약된 오전 11시 30분 인터뷰를 위해 연락하며 시간 여부를 확인했다.
인터뷰는 약 10분 소요되며, 승인 시 프로필 카드 정보를 수집하기 위한 목적으로 진행된다.

수의사 직업 소개와 선택 계기
응답자는 동물 2차 병원의 외과 과장으로 외과 수의사로 근무 중이다.
수의사 커리어 선택은 대학 진학 시부터 과의 특성상 결정되었다.

수의사 재화님의 직업 선택과 여가시간
재화님은 동물을 좋아하고 강아지를 키우다 보니 보람 있고 전문적인 수의사 직업이 잘 맞아 선택했다.
외과 업무로 인해 여가시간이 많지 않아 별다른 취미 활동이 어렵다.

재화님의 여가 활동과 필립 & 소피 클럽 소개
재화님은 여가 시간에 새로운 수술법 세미나를 듣는 데 많은 시간을 할애하나, 지치거나 힘들 때는 석촌호수에서 런닝을 한다.

독서모임 지원 동기 설명
인스타그램에서 독서모임을 보고 지원하게 되었다.
평소 전공 서적만 읽어 다양한 분야의 책을 읽고 싶다.
자투리 시간을 활용해 책을 읽고 주 1회 모임에 참여할 수 있다.

재화님의 독서 빈도와 선호 장르 논의
재화님은 관심 분야에 따라 독서 빈도가 다르며, 요즘 재테크 관련 책을 사놓고 한두세 달에 한 권 정독한다.
선호 장르는 전공서적과 재테크 등 도움이 되는 책 위주이다.
재환님은 요즘 책을 다양하게 접하고 싶다는 생각이 들며, 어떤 분야든 안목을 넓히기 위해 한정하지 않고 읽을 수 있을 것 같다고 한다.

재화님의 성격 유형과 타인 이미지에 대한 생각
재화님은 처음에는 먼저 나서지 않고 주로 듣는 역할을 하며 반응을 보이는 타입이다.
친해진 후에는 더 주도적으로 행동하는 편이다.
재화님은 시간이 지나면서 남들에게 어떻게 보이는지에 신경 쓰지 않으려고 노력한다.

재환님의 이상형과 프로필 키워드 설명
재환님은 남들에게 큰 피해를 주지 않고 상대방이 편안하게 고민이나 어려움을 공유할 수 있는 사람을 원한다.

회원 프로필 키워드 세 가지 추천 요청
재화님은 자신의 분야에 대한 열정적과 프로페셔널을 키워드로 제시함.
지원자의 삶과 여가 균형 및 긍정적 태도를 인정하며 인터뷰에 감사 인사를 전했다.`;

async function test() {
  console.log('Testing welcome message generation with gemini-3-flash-preview...\n');

  const memberName = '정재환';

  const userPrompt = `
멤버 이름: ${memberName}

인터뷰 요약:
${callSummary}

위 인터뷰 요약을 바탕으로 ${memberName}님을 위한 개인화된 환영 메시지를 작성해주세요.
메시지만 출력하세요 (다른 설명 없이).
`;

  try {
    const startTime = Date.now();

    const result = await generateText({
      model: google('gemini-3-flash-preview'),
      system: SYSTEM_PROMPT,
      prompt: userPrompt,
    });

    const endTime = Date.now();
    const message = result.text.trim();

    console.log('=== 생성된 환영 메시지 ===');
    console.log(message);
    console.log('\n=== 메타데이터 ===');
    console.log(`길이: ${message.length}자`);
    console.log(`소요시간: ${endTime - startTime}ms`);

  } catch (error) {
    console.error('Error:', error);
  }
}

test();
